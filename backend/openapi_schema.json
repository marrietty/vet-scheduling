{"openapi":"3.1.0","info":{"title":"Vet Clinic Scheduling System API","description":"REST API backend for a veterinary clinic scheduling system with role-based access control","version":"1.0.0"},"paths":{"/api/v1/auth/register":{"post":{"tags":["Authentication"],"summary":"Register","description":"Register a new user and return JWT token (auto-login).\n\nThis endpoint:\n1. Validates email format (via Pydantic EmailStr)\n2. Checks for duplicate email\n3. Assigns role based on ADMIN_EMAIL configuration\n4. Hashes password using bcrypt\n5. Creates user in database\n6. Automatically generates and returns JWT token\n\nArgs:\n    request: RegisterRequest containing email and password\n    session: Database session (injected dependency)\n    \nReturns:\n    TokenResponse with JWT access token and token type\n    \nRaises:\n    400 Bad Request: If email is already registered\n    422 Unprocessable Entity: If email format is invalid\n    \nRequirements:\n    - 1.1: Create user account with hashed password\n    - 1.2: Assign \"admin\" role if email matches ADMIN_EMAIL\n    - 1.3: Assign \"pet_owner\" role otherwise\n    - 1.4: Reject duplicate email registration\n    - 1.5: Return JWT token (auto-login after registration)\n    - 1.7: Hash passwords using bcrypt\n    - 1.8: Validate email format","operationId":"register_api_v1_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/login":{"post":{"tags":["Authentication"],"summary":"Login","description":"Login existing user and return JWT token.\n\nThis endpoint:\n1. Validates credentials (email and password)\n2. Checks if user account is active\n3. Generates and returns JWT token\n\nArgs:\n    request: LoginRequest containing email and password\n    session: Database session (injected dependency)\n    \nReturns:\n    TokenResponse with JWT access token and token type\n    \nRaises:\n    401 Unauthorized: If credentials are invalid\n    403 Forbidden: If user account is deactivated\n    \nRequirements:\n    - 1.5: Return JWT token for valid credentials\n    - 1.6: Reject login with invalid credentials","operationId":"login_api_v1_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/logout":{"post":{"tags":["Authentication"],"summary":"Logout","description":"Logout user by invalidating their JWT token.\n\nThis endpoint securely logs out a user by adding their current JWT token to a blacklist,\npreventing any future use of that token for authentication. The token remains blacklisted\nuntil its natural expiration time.\n\n**Process:**\n1. Extracts the JWT token from the Authorization header (Bearer token)\n2. Validates the token and authenticates the user (via get_current_user dependency)\n3. Adds the token to the token_blacklist table with its expiration timestamp\n4. Returns a success message confirming logout\n\n**Parameters:**\n- **Authorization header**: Required. Must contain a valid Bearer token\n  - Format: `Authorization: Bearer <token>`\n\n**Request Body:** None\n\n**Response Format:**\n```json\n{\n    \"message\": \"Successfully logged out\"\n}\n```\n\n**Error Responses:**\n- **401 Unauthorized**: \n  - Token is invalid, malformed, or expired\n  - Token is missing from Authorization header\n  - Token has already been blacklisted (already logged out)\n  - Message: \"Invalid or expired token\" or \"Token has been invalidated\"\n- **403 Forbidden**: \n  - User account has been deactivated\n  - Message: \"User account is deactivated\"\n\n**Example Usage:**\n```bash\ncurl -X POST \"http://localhost:8000/api/v1/auth/logout\"          -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n```\n\n**Requirements Satisfied:**\n- **Requirement 1.1**: Add user's current token to the Token_Blacklist\n- **Requirement 1.2**: Blacklisted tokens are rejected for authentication\n- **Requirement 1.3**: Store token value and expiration timestamp in blacklist\n- **Requirement 1.4**: Validate token exists and is currently valid before blacklisting\n- **Requirement 1.5**: Provide endpoint that accepts authenticated requests and invalidates token\n\n**Security Notes:**\n- After logout, the token cannot be used for any authenticated requests\n- The token remains in the blacklist until its natural expiration time\n- Users must login again to receive a new valid token\n- Attempting to logout with an already-blacklisted token will fail with 401","operationId":"logout_api_v1_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LogoutResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/users/profile":{"get":{"tags":["Users"],"summary":"Get Profile","description":"Get current user's profile information.\n\nRetrieves the complete profile information for the currently authenticated user,\nexcluding sensitive security information like password hashes. This endpoint\nreturns all user-facing profile data including personal details, contact information,\nrole, and preferences.\n\n**Process:**\n1. Authenticates the user via JWT token (get_current_user dependency)\n2. Retrieves the user's complete profile from the database\n3. Filters out sensitive fields (hashed_password, etc.)\n4. Returns all non-sensitive profile information\n\n**Parameters:**\n- **Authorization header**: Required. Must contain a valid Bearer token\n  - Format: `Authorization: Bearer <token>`\n\n**Request Body:** None\n\n**Response Format:**\n```json\n{\n    \"id\": \"uuid-string\",\n    \"full_name\": \"John Doe\",\n    \"email\": \"john.doe@example.com\",\n    \"phone\": \"+1-555-0123\",\n    \"city\": \"San Francisco\",\n    \"role\": \"pet_owner\",\n    \"is_active\": true,\n    \"preferences\": {\n        \"notifications\": true,\n        \"theme\": \"light\"\n    },\n    \"created_at\": \"2024-01-15T10:30:00Z\"\n}\n```\n\n**Response Fields:**\n- **id**: Unique user identifier (UUID)\n- **full_name**: User's full name\n- **email**: User's email address\n- **phone**: User's phone number (optional, may be null)\n- **city**: User's city location (optional, may be null)\n- **role**: User's role in the system (e.g., \"pet_owner\", \"admin\")\n- **is_active**: Whether the user account is active\n- **preferences**: User preferences as JSON object (optional, may be null or empty)\n- **created_at**: Account creation timestamp\n\n**Error Responses:**\n- **401 Unauthorized**: \n  - Token is invalid, expired, or missing\n  - Token has been blacklisted (user logged out)\n  - Message: \"Invalid or expired token\" or \"Token has been invalidated\"\n- **403 Forbidden**: \n  - User account has been deactivated\n  - Message: \"User account is deactivated\"\n- **404 Not Found**: \n  - User record not found in database (rare edge case)\n  - Message: \"User not found\"\n\n**Example Usage:**\n```bash\ncurl -X GET \"http://localhost:8000/api/v1/users/profile\"          -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n```\n\n**Requirements Satisfied:**\n- **Requirement 2.1**: Return user's full name, email, phone, city, role, and account status\n- **Requirement 2.2**: Do not return hashed password or other sensitive security information\n- **Requirement 2.3**: Require valid authentication to access profile information\n- **Requirement 2.4**: Return unauthorized error for unauthenticated requests\n- **Requirement 4.3**: Include city field in profile display if present\n- **Requirement 8.3**: Include current preferences when user retrieves profile\n\n**Security Notes:**\n- Only the authenticated user can view their own profile\n- Sensitive fields like password hashes are never included in the response\n- Token must be valid and not blacklisted","operationId":"get_profile_api_v1_users_profile_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfileResponse"}}}}},"security":[{"HTTPBearer":[]}]},"patch":{"tags":["Users"],"summary":"Update Profile","description":"Update current user's profile information.\n\nAllows the authenticated user to update their profile information including personal\ndetails, contact information, and preferences. All fields are optional - only the\nfields provided in the request will be updated. The endpoint performs comprehensive\nvalidation to ensure data integrity and uniqueness constraints.\n\n**Process:**\n1. Authenticates the user via JWT token (get_current_user dependency)\n2. Validates all provided updates according to business rules\n3. Checks email uniqueness if email is being updated\n4. Validates phone format if phone is being updated\n5. Validates city format if city is being updated\n6. Updates only the provided fields in the database\n7. Returns the complete updated profile information\n\n**Parameters:**\n- **Authorization header**: Required. Must contain a valid Bearer token\n  - Format: `Authorization: Bearer <token>`\n\n**Request Body:** (All fields optional)\n```json\n{\n    \"full_name\": \"Jane Smith\",\n    \"email\": \"jane.smith@example.com\",\n    \"phone\": \"+1-555-9876\",\n    \"city\": \"Los Angeles\",\n    \"preferences\": {\n        \"notifications\": false,\n        \"theme\": \"dark\",\n        \"language\": \"en\"\n    }\n}\n```\n\n**Request Fields:**\n- **full_name** (optional): User's full name\n  - Must not be empty or whitespace-only\n  - Validation: Non-empty string after trimming\n- **email** (optional): User's email address\n  - Must be valid email format (contains @, valid domain)\n  - Must not be already used by another user\n  - Validation: Email format + uniqueness check\n- **phone** (optional): User's phone number\n  - Must match valid phone format\n  - Validation: Phone number pattern\n- **city** (optional): User's city location\n  - Must not be empty or whitespace-only if provided\n  - Validation: Non-empty string after trimming\n- **preferences** (optional): User preferences as JSON object\n  - Must be valid JSON structure\n  - Can contain any key-value pairs\n  - Validation: Valid JSON object structure\n\n**Response Format:**\n```json\n{\n    \"id\": \"uuid-string\",\n    \"full_name\": \"Jane Smith\",\n    \"email\": \"jane.smith@example.com\",\n    \"phone\": \"+1-555-9876\",\n    \"city\": \"Los Angeles\",\n    \"role\": \"pet_owner\",\n    \"is_active\": true,\n    \"preferences\": {\n        \"notifications\": false,\n        \"theme\": \"dark\",\n        \"language\": \"en\"\n    },\n    \"created_at\": \"2024-01-15T10:30:00Z\"\n}\n```\n\n**Error Responses:**\n- **401 Unauthorized**: \n  - Token is invalid, expired, or missing\n  - Token has been blacklisted (user logged out)\n  - Message: \"Invalid or expired token\" or \"Token has been invalidated\"\n- **403 Forbidden**: \n  - User account has been deactivated\n  - Message: \"User account is deactivated\"\n- **404 Not Found**: \n  - User record not found in database\n  - Message: \"User not found\"\n- **409 Conflict**: \n  - Email is already used by another user\n  - Message: \"Email already in use\"\n- **422 Unprocessable Entity**: \n  - Validation fails for any field\n  - Messages:\n    - \"Full name cannot be empty\"\n    - \"Invalid email format\"\n    - \"Invalid phone number format\"\n    - \"City cannot be empty\"\n    - \"Invalid preferences structure\"\n\n**Example Usage:**\n```bash\n# Update multiple fields\ncurl -X PATCH \"http://localhost:8000/api/v1/users/profile\"          -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"          -H \"Content-Type: application/json\"          -d '{\n       \"full_name\": \"Jane Smith\",\n       \"city\": \"Los Angeles\",\n       \"preferences\": {\"notifications\": false}\n     }'\n\n# Update only preferences\ncurl -X PATCH \"http://localhost:8000/api/v1/users/profile\"          -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"          -H \"Content-Type: application/json\"          -d '{\"preferences\": {\"theme\": \"dark\"}}'\n```\n\n**Requirements Satisfied:**\n- **Requirement 3.1**: Validate name is not empty and update user record\n- **Requirement 3.2**: Validate email format and ensure not already used by another user\n- **Requirement 3.3**: Validate phone format and update user record\n- **Requirement 3.4**: Update city field in user record\n- **Requirement 3.5**: Store preferences data associated with user\n- **Requirement 3.6**: Require valid authentication to update profile information\n- **Requirement 3.7**: Reject attempts to update another user's profile (enforced by get_current_user)\n- **Requirement 3.8**: Return descriptive error messages when validation fails\n- **Requirement 4.4**: Validate city value is non-empty string if provided\n- **Requirement 8.2**: Validate preferences data structure\n- **Requirement 8.5**: Allow preferences to be updated independently from other profile fields\n\n**Security Notes:**\n- Users can only update their own profile (enforced by authentication)\n- Email uniqueness is enforced across all users\n- All validation is performed before any database updates\n- Partial updates are supported - unchanged fields remain as-is","operationId":"update_profile_api_v1_users_profile_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfileUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfileResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/pets":{"get":{"tags":["Pets"],"summary":"Get Pets","description":"Get all pets (filtered by role).\n\n- Admin users: Returns all pets in the system\n- Pet owners: Returns only pets owned by the authenticated user\n\nAll pets include a computed vaccination_status field.\n\nArgs:\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    List of pets with computed vaccination_status\n    \nRaises:\n    401: If authentication fails\n    \nRequirements: 3.2, 3.3, 4.4","operationId":"get_pets_api_v1_pets_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PetResponse"},"type":"array","title":"Response Get Pets Api V1 Pets Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["Pets"],"summary":"Create Pet","description":"Create a new pet.\n\nThe pet is automatically associated with the authenticated user as the owner.\nReturns the created pet with a computed vaccination_status field.\n\nArgs:\n    request: Pet creation request data\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    Created pet with computed vaccination_status\n    \nRaises:\n    401: If authentication fails\n    422: If request data is invalid\n    \nRequirements: 3.1, 4.4","operationId":"create_pet_api_v1_pets_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PetCreateRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/pets/{pet_id}":{"get":{"tags":["Pets"],"summary":"Get Pet","description":"Get a specific pet.\n\n- Admin users: Can access any pet\n- Pet owners: Can only access their own pets\n\nReturns the pet with a computed vaccination_status field.\n\nArgs:\n    pet_id: UUID of the pet to retrieve\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    Pet with computed vaccination_status\n    \nRaises:\n    401: If authentication fails\n    403: If pet owner tries to access another user's pet\n    404: If pet doesn't exist\n    \nRequirements: 3.4, 4.4","operationId":"get_pet_api_v1_pets__pet_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"pet_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Pet Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["Pets"],"summary":"Update Pet","description":"Update a pet.\n\n- Admin users: Can update any pet\n- Pet owners: Can only update their own pets\n\nOnly provided fields are updated (partial update support).\nReturns the updated pet with a computed vaccination_status field.\n\nArgs:\n    pet_id: UUID of the pet to update\n    request: Pet update request data (all fields optional)\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    Updated pet with computed vaccination_status\n    \nRaises:\n    401: If authentication fails\n    403: If pet owner tries to update another user's pet\n    404: If pet doesn't exist\n    422: If request data is invalid\n    \nRequirements: 3.5, 4.4","operationId":"update_pet_api_v1_pets__pet_id__patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"pet_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Pet Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PetUpdateRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Pets"],"summary":"Delete Pet","description":"Delete a pet.\n\n- Admin users: Can delete any pet\n- Pet owners: Can only delete their own pets\n\nArgs:\n    pet_id: UUID of the pet to delete\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    No content (204 status code)\n    \nRaises:\n    401: If authentication fails\n    403: If pet owner tries to delete another user's pet\n    404: If pet doesn't exist\n    \nRequirements: 3.6","operationId":"delete_pet_api_v1_pets__pet_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"pet_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Pet Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/appointments":{"post":{"tags":["Appointments"],"summary":"Create Appointment","description":"Create a new appointment.\n\nThe appointment is validated against business rules:\n- Pet must exist and be owned by the user (or user is admin)\n- Start time must be in the future\n- Clinic must not be closed\n- Time slot must not overlap with existing pending/confirmed appointments\n- End time is automatically calculated based on service type\n\nThe created appointment has status \"pending\".\n\nArgs:\n    request: Appointment creation request data\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    Created appointment\n    \nRaises:\n    401: If authentication fails\n    403: If pet owner tries to book for another user's pet\n    404: If pet doesn't exist\n    400: If validation fails (past time, clinic closed, overlap)\n    422: If request data is invalid\n    \nRequirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.10, 5.11, 5.12","operationId":"create_appointment_api_v1_appointments_post","security":[{"HTTPBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentCreateRequest"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["Appointments"],"summary":"Get Appointments","description":"Get appointments with optional filters.\n\n- Admin users: Returns all appointments in the system\n- Pet owners: Returns only appointments for pets owned by the authenticated user\n\nSupports filtering by:\n- status: Filter by appointment status (pending, confirmed, cancelled, completed)\n- from_date: Only appointments starting on or after this date\n- to_date: Only appointments starting on or before this date\n\nMultiple filters can be combined.\n\nArgs:\n    status: Optional status filter\n    from_date: Optional start date filter\n    to_date: Optional end date filter\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    List of appointments matching the filters\n    \nRaises:\n    401: If authentication fails\n    \nRequirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6","operationId":"get_appointments_api_v1_appointments_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by appointment status","title":"Status"},"description":"Filter by appointment status"},{"name":"from_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter appointments starting on or after this date","title":"From Date"},"description":"Filter appointments starting on or after this date"},{"name":"to_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Filter appointments starting on or before this date","title":"To Date"},"description":"Filter appointments starting on or before this date"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AppointmentResponse"},"title":"Response Get Appointments Api V1 Appointments Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/appointments/{appointment_id}/status":{"patch":{"tags":["Appointments"],"summary":"Update Appointment Status","description":"Update appointment status (admin only).\n\nThis endpoint is restricted to admin users only. Admins can:\n- Confirm pending appointments (pending -> confirmed)\n- Complete confirmed appointments (confirmed -> completed)\n- Cancel appointments (any status -> cancelled, except completed)\n\nStatus transition rules:\n- Cannot change status of completed appointments\n- Cannot change status of cancelled appointments\n- Cannot cancel completed appointments\n\nArgs:\n    appointment_id: UUID of the appointment to update\n    request: Status update request data\n    current_user: Authenticated admin user (from JWT token)\n    session: Database session\n    \nReturns:\n    Updated appointment\n    \nRaises:\n    401: If authentication fails\n    403: If user is not an admin\n    404: If appointment doesn't exist\n    400: If status transition is invalid\n    422: If request data is invalid\n    \nRequirements: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6","operationId":"update_appointment_status_api_v1_appointments__appointment_id__status_patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"appointment_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Appointment Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentUpdateStatusRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/appointments/{appointment_id}/reschedule":{"patch":{"tags":["Appointments"],"summary":"Reschedule Appointment","description":"Reschedule an appointment to a new time slot.\n\nAllows pet owners to reschedule appointments for their own pets to a different date\nand time. The endpoint performs comprehensive validation to ensure the new time slot\nis valid, available, and within clinic operating hours. Only appointments in\n'scheduled' or 'confirmed' status can be rescheduled.\n\n**Process:**\n1. Authenticates the user via JWT token (get_current_user dependency)\n2. Validates the user owns the pet associated with the appointment\n3. Verifies the appointment status is 'scheduled' or 'confirmed'\n4. Validates the new time range (end_time must be after start_time)\n5. Checks that the clinic is open during the requested time\n6. Verifies the new time slot doesn't conflict with existing appointments\n7. Updates the appointment's start_time and end_time\n8. Updates the appointment's updated_at timestamp\n9. Returns the updated appointment\n\n**Parameters:**\n- **appointment_id** (path): UUID of the appointment to reschedule\n- **Authorization header**: Required. Must contain a valid Bearer token\n  - Format: `Authorization: Bearer <token>`\n\n**Request Body:**\n```json\n{\n    \"start_time\": \"2024-02-15T14:00:00Z\",\n    \"end_time\": \"2024-02-15T15:00:00Z\"\n}\n```\n\n**Request Fields:**\n- **start_time** (required): New start time for the appointment\n  - Must be a valid ISO 8601 datetime\n  - Must be in the future\n  - Must fall within clinic operating hours\n- **end_time** (required): New end time for the appointment\n  - Must be a valid ISO 8601 datetime\n  - Must be after start_time\n  - Must fall within clinic operating hours\n\n**Response Format:**\n```json\n{\n    \"id\": \"uuid-string\",\n    \"pet_id\": \"uuid-string\",\n    \"start_time\": \"2024-02-15T14:00:00Z\",\n    \"end_time\": \"2024-02-15T15:00:00Z\",\n    \"service_type\": \"checkup\",\n    \"status\": \"scheduled\",\n    \"notes\": \"Annual checkup\",\n    \"created_at\": \"2024-01-15T10:30:00Z\",\n    \"updated_at\": \"2024-01-20T16:45:00Z\"\n}\n```\n\n**Error Responses:**\n- **401 Unauthorized**: \n  - Token is invalid, expired, or missing\n  - Token has been blacklisted (user logged out)\n  - Message: \"Invalid or expired token\" or \"Token has been invalidated\"\n- **403 Forbidden**: \n  - User doesn't own the pet associated with the appointment\n  - Message: \"You can only reschedule appointments for your own pets\"\n- **404 Not Found**: \n  - Appointment with the given ID doesn't exist\n  - Message: \"Appointment not found\"\n- **409 Conflict**: \n  - New time slot conflicts with an existing appointment (double booking)\n  - Message: \"The requested time slot is not available\"\n- **422 Unprocessable Entity**: \n  - Validation fails for the request data\n  - Messages:\n    - \"End time must be after start time\"\n    - \"Clinic is closed during the requested time\"\n    - \"Cannot reschedule completed or cancelled appointments\"\n    - \"Appointment status must be 'scheduled' or 'confirmed'\"\n    - \"Start time must be in the future\"\n\n**Validation Rules:**\n- **Ownership**: User must own the pet associated with the appointment\n- **Status**: Appointment must be in 'scheduled' or 'confirmed' status\n- **Time Range**: end_time must be after start_time\n- **Clinic Hours**: Both start_time and end_time must fall within clinic operating hours\n- **Availability**: New time slot must not overlap with existing appointments\n- **Future Time**: start_time must be in the future\n\n**Example Usage:**\n```bash\ncurl -X PATCH \"http://localhost:8000/api/v1/appointments/123e4567-e89b-12d3-a456-426614174000/reschedule\"          -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"          -H \"Content-Type: application/json\"          -d '{\n       \"start_time\": \"2024-02-15T14:00:00Z\",\n       \"end_time\": \"2024-02-15T15:00:00Z\"\n     }'\n```\n\n**Requirements Satisfied:**\n- **Requirement 6.1**: Validate user owns the pet associated with the appointment\n- **Requirement 6.2**: Require both new start time and end time\n- **Requirement 6.3**: Validate new time slot does not conflict with existing appointments\n- **Requirement 6.4**: Check that clinic is open during the requested time\n- **Requirement 6.5**: Update appointment's start time and end time\n- **Requirement 6.6**: Reject reschedule requests that would create double booking\n- **Requirement 6.7**: Update appointment's updated_at timestamp\n- **Requirement 6.8**: Allow rescheduling only for appointments with status \"scheduled\" or \"confirmed\"\n- **Requirement 6.9**: Reject attempts to reschedule completed or cancelled appointments\n\n**Security Notes:**\n- Pet owners can only reschedule appointments for their own pets\n- Admin users can reschedule any appointment\n- All validation is performed before any database updates\n- The updated_at timestamp is automatically updated on successful reschedule\n\n**Business Rules:**\n- Completed appointments cannot be rescheduled\n- Cancelled appointments cannot be rescheduled\n- The new time slot must not create a double booking\n- The clinic must be open during the entire duration of the new time slot","operationId":"reschedule_appointment_api_v1_appointments__appointment_id__reschedule_patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"appointment_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Appointment Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentReschedule"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppointmentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/appointments/{appointment_id}":{"delete":{"tags":["Appointments"],"summary":"Cancel Appointment","description":"Cancel/delete an appointment.\n\n- Admin users: Can cancel any appointment\n- Pet owners: Can only cancel appointments for their own pets\n\nCannot cancel completed appointments.\n\nArgs:\n    appointment_id: UUID of the appointment to cancel\n    current_user: Authenticated user (from JWT token)\n    session: Database session\n    \nReturns:\n    No content (204 status code)\n    \nRaises:\n    401: If authentication fails\n    403: If pet owner tries to cancel another user's appointment\n    404: If appointment doesn't exist\n    400: If trying to cancel a completed appointment\n    \nRequirements: 6.7, 6.8, 6.9, 6.10","operationId":"cancel_appointment_api_v1_appointments__appointment_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"appointment_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Appointment Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/clinic/status":{"get":{"tags":["Clinic"],"summary":"Get Clinic Status","description":"Get clinic status (public endpoint, no auth required).\n\nThis endpoint is publicly accessible without authentication, allowing\nanyone to check the current operational status of the clinic.\n\nArgs:\n    session: Database session\n    \nReturns:\n    Current clinic status and last updated timestamp\n    \nExample Response:\n    {\n        \"status\": \"open\",\n        \"updated_at\": \"2024-01-15T10:30:00Z\"\n    }\n    \nRequirements: 8.1","operationId":"get_clinic_status_api_v1_clinic_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClinicStatusResponse"}}}}}},"patch":{"tags":["Clinic"],"summary":"Update Clinic Status","description":"Update clinic status (admin only).\n\nThis endpoint allows administrators to change the operational status\nof the clinic. Only users with the \"admin\" role can access this endpoint.\n\nValid status values:\n- \"open\": Clinic is open for appointments\n- \"close\": Clinic is closed, no new appointments can be created\n- \"closing_soon\": Clinic is closing soon\n\nArgs:\n    request: Clinic status update request with new status\n    current_user: Authenticated admin user (from JWT token)\n    session: Database session\n    \nReturns:\n    Updated clinic status and timestamp\n    \nRaises:\n    401: If authentication fails\n    403: If user is not an admin\n    422: If request data is invalid\n    \nExample Request:\n    {\n        \"status\": \"close\"\n    }\n    \nExample Response:\n    {\n        \"status\": \"close\",\n        \"updated_at\": \"2024-01-15T10:35:00Z\"\n    }\n    \nRequirements: 8.2, 8.3","operationId":"update_clinic_status_api_v1_clinic_status_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClinicStatusUpdateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClinicStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/":{"get":{"tags":["Root"],"summary":"Read Root","description":"Root endpoint providing API information.\n\nReturns:\n    API welcome message and documentation links","operationId":"read_root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"tags":["Health"],"summary":"Health Check","description":"Health check endpoint.\n\nReturns:\n    API health status","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AppointmentCreateRequest":{"properties":{"pet_id":{"type":"string","format":"uuid","title":"Pet Id","description":"ID of the pet for this appointment"},"start_time":{"type":"string","format":"date-time","title":"Start Time","description":"When the appointment starts (must be in the future)"},"service_type":{"type":"string","title":"Service Type","description":"Type of service: vaccination, routine, surgery, or emergency"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes","description":"Optional notes about the appointment"}},"type":"object","required":["pet_id","start_time","service_type"],"title":"AppointmentCreateRequest","description":"Request schema for creating a new appointment.\n\nThe end_time is automatically calculated based on the service_type:\n- vaccination: 30 minutes\n- routine: 45 minutes\n- surgery: 120 minutes\n- emergency: 15 minutes\n\nAttributes:\n    pet_id: ID of the pet for this appointment (required)\n    start_time: When the appointment starts (required, must be in the future)\n    service_type: Type of service (required: vaccination, routine, surgery, emergency)\n    notes: Optional notes about the appointment\n\nRequirements: 5.1"},"AppointmentReschedule":{"properties":{"start_time":{"type":"string","format":"date-time","title":"Start Time","description":"New start time for the appointment"},"end_time":{"type":"string","format":"date-time","title":"End Time","description":"New end time for the appointment"}},"type":"object","required":["start_time","end_time"],"title":"AppointmentReschedule","description":"Request schema for rescheduling an appointment.\n\nBoth start_time and end_time are required. The end_time must be after\nthe start_time to ensure a valid time range.\n\nAttributes:\n    start_time: New start time for the appointment (required)\n    end_time: New end time for the appointment (required, must be after start_time)\n\nRequirements: 6.2"},"AppointmentResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"pet_id":{"type":"string","format":"uuid","title":"Pet Id"},"user_id":{"type":"string","format":"uuid","title":"User Id"},"start_time":{"type":"string","format":"date-time","title":"Start Time"},"end_time":{"type":"string","format":"date-time","title":"End Time"},"service_type":{"type":"string","title":"Service Type"},"status":{"type":"string","title":"Status"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","pet_id","user_id","start_time","end_time","service_type","status","notes","created_at","updated_at"],"title":"AppointmentResponse","description":"Response schema for appointment data.\n\nIncludes all appointment fields with computed end_time based on service_type.\n\nAttributes:\n    id: Unique identifier for the appointment\n    pet_id: ID of the pet for this appointment\n    user_id: ID of the user who booked this appointment\n    start_time: When the appointment starts\n    end_time: When the appointment ends (calculated based on service_type)\n    service_type: Type of service (vaccination, routine, surgery, emergency)\n    status: Current status (pending, confirmed, cancelled, completed)\n    notes: Optional notes about the appointment\n    created_at: Timestamp when the appointment was created\n    updated_at: Timestamp when the appointment was last updated\n\nRequirements: 5.1, 6.1"},"AppointmentUpdateStatusRequest":{"properties":{"status":{"type":"string","title":"Status","description":"New status: confirmed, completed, or cancelled"}},"type":"object","required":["status"],"title":"AppointmentUpdateStatusRequest","description":"Request schema for updating an appointment's status.\n\nValid status transitions:\n- pending -> confirmed (admin only)\n- pending -> cancelled (owner or admin)\n- confirmed -> completed (admin only)\n- confirmed -> cancelled (owner or admin)\n\nInvalid transitions:\n- Cannot change status of completed appointments\n- Cannot change status of cancelled appointments\n\nAttributes:\n    status: New status (required: confirmed, completed, or cancelled)\n\nRequirements: 6.1"},"ClinicStatusResponse":{"properties":{"status":{"type":"string","title":"Status","description":"Current operational status: open, close, or closing_soon"},"updated_at":{"type":"string","format":"date-time","title":"Updated At","description":"Timestamp when the status was last updated"}},"type":"object","required":["status","updated_at"],"title":"ClinicStatusResponse","description":"Response schema for clinic status.\n\nReturns the current operational status of the clinic and when it was last updated.\nThis endpoint is public and does not require authentication.\n\nAttributes:\n    status: Current operational status (open, close, closing_soon)\n    updated_at: Timestamp when the status was last updated\n\nRequirements: 8.1"},"ClinicStatusUpdateRequest":{"properties":{"status":{"type":"string","title":"Status","description":"New operational status: open, close, or closing_soon"}},"type":"object","required":["status"],"title":"ClinicStatusUpdateRequest","description":"Request schema for updating clinic status.\n\nAllows administrators to change the operational status of the clinic.\nOnly admin users can update the clinic status.\n\nAttributes:\n    status: New operational status (open, close, closing_soon)\n\nRequirements: 8.2"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"LoginRequest","description":"Request schema for user login.\n\nAttributes:\n    email: Email address of the user\n    password: Password for authentication"},"LogoutResponse":{"properties":{"message":{"type":"string","title":"Message","default":"Successfully logged out"}},"type":"object","title":"LogoutResponse","description":"Response schema for successful logout.\n\nAttributes:\n    message: Success message confirming logout"},"PetCreateRequest":{"properties":{"name":{"type":"string","maxLength":100,"minLength":1,"title":"Name","description":"Pet's name"},"species":{"type":"string","maxLength":50,"minLength":1,"title":"Species","description":"Type of animal (e.g., dog, cat, bird)"},"breed":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Breed","description":"Specific breed"},"date_of_birth":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Date Of Birth","description":"Pet's date of birth"},"last_vaccination":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Vaccination","description":"Date of last vaccination"},"medical_history":{"additionalProperties":true,"type":"object","title":"Medical History","description":"JSON object storing medical records and notes"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes","description":"Additional notes about the pet"}},"type":"object","required":["name","species"],"title":"PetCreateRequest","description":"Request schema for creating a new pet.\n\nAttributes:\n    name: Pet's name (required)\n    species: Type of animal (required)\n    breed: Specific breed (optional)\n    date_of_birth: Pet's date of birth (optional)\n    last_vaccination: Date of last vaccination (optional)\n    medical_history: JSON object storing medical records (default: empty dict)\n    notes: Additional notes about the pet (optional)\n\nRequirements: 3.1, 5.2"},"PetResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"species":{"type":"string","title":"Species"},"breed":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Breed"},"date_of_birth":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Date Of Birth"},"last_vaccination":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Vaccination"},"vaccination_status":{"type":"string","title":"Vaccination Status","description":"Computed vaccination status: valid, expired, or unknown"},"medical_history":{"additionalProperties":true,"type":"object","title":"Medical History"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"owner_id":{"type":"string","format":"uuid","title":"Owner Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","name","species","breed","date_of_birth","last_vaccination","vaccination_status","medical_history","notes","owner_id","created_at","updated_at"],"title":"PetResponse","description":"Response schema for pet data.\n\nIncludes all pet fields plus a computed vaccination_status field.\nThe vaccination_status is computed based on the last_vaccination date:\n- \"unknown\": No vaccination date recorded\n- \"expired\": Last vaccination was more than 365 days ago\n- \"valid\": Last vaccination was 365 days or less ago\n\nAttributes:\n    id: Unique identifier for the pet\n    name: Pet's name\n    species: Type of animal\n    breed: Specific breed (optional)\n    date_of_birth: Pet's date of birth (optional)\n    last_vaccination: Date of last vaccination (optional)\n    vaccination_status: Computed vaccination status (valid, expired, unknown)\n    medical_history: JSON object storing medical records\n    notes: Additional notes about the pet (optional)\n    owner_id: ID of the user who owns this pet\n    created_at: Timestamp when the pet was registered\n    updated_at: Timestamp when the pet was last updated\n\nRequirements: 3.4, 4.4, 5.4"},"PetUpdateRequest":{"properties":{"name":{"anyOf":[{"type":"string","maxLength":100,"minLength":1},{"type":"null"}],"title":"Name","description":"Pet's name"},"species":{"anyOf":[{"type":"string","maxLength":50,"minLength":1},{"type":"null"}],"title":"Species","description":"Type of animal"},"breed":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Breed","description":"Specific breed"},"date_of_birth":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Date Of Birth","description":"Pet's date of birth"},"last_vaccination":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Vaccination","description":"Date of last vaccination"},"medical_history":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Medical History","description":"JSON object storing medical records and notes"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes","description":"Additional notes about the pet"}},"type":"object","title":"PetUpdateRequest","description":"Request schema for updating an existing pet.\n\nAll fields are optional to support partial updates.\n\nAttributes:\n    name: Pet's name (optional)\n    species: Type of animal (optional)\n    breed: Specific breed (optional)\n    date_of_birth: Pet's date of birth (optional)\n    last_vaccination: Date of last vaccination (optional)\n    medical_history: JSON object storing medical records (optional)\n    notes: Additional notes about the pet (optional)\n\nRequirements: 3.1, 5.3"},"RegisterRequest":{"properties":{"full_name":{"type":"string","maxLength":200,"minLength":1,"title":"Full Name","description":"Full name of the user"},"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","maxLength":64,"minLength":8,"title":"Password","description":"Password must be 8-64 characters long"}},"type":"object","required":["full_name","email","password"],"title":"RegisterRequest","description":"Request schema for user registration.\n\nAttributes:\n    full_name: Full name of the user\n    email: Valid email address for the user account\n    password: Password for the user account (8-64 characters, will be hashed before storage)"},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"}},"type":"object","required":["access_token"],"title":"TokenResponse","description":"Response schema for successful authentication.\n\nAttributes:\n    access_token: JWT access token for authenticated requests\n    token_type: Type of token (always \"bearer\")"},"UserProfileResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id","description":"Unique identifier for the user"},"full_name":{"type":"string","title":"Full Name","description":"User's full name"},"email":{"type":"string","title":"Email","description":"User's email address"},"phone":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Phone","description":"User's phone number"},"city":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"City","description":"User's city location"},"role":{"type":"string","title":"Role","description":"User role (admin or pet_owner)"},"is_active":{"type":"boolean","title":"Is Active","description":"Whether the user account is active"},"preferences":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Preferences","description":"User preferences"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Timestamp when the user was created"}},"type":"object","required":["id","full_name","email","role","is_active","created_at"],"title":"UserProfileResponse","description":"Response schema for user profile information.\n\nThis schema includes all non-sensitive user information for API responses.\nSensitive fields like hashed_password are explicitly excluded.\n\nAttributes:\n    id: Unique identifier for the user\n    full_name: User's full name\n    email: User's email address\n    phone: User's phone number (optional)\n    city: User's city location (optional)\n    role: User role (admin or pet_owner)\n    is_active: Whether the user account is active\n    preferences: User preferences stored as JSON (optional)\n    created_at: Timestamp when the user was created"},"UserProfileUpdate":{"properties":{"full_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Full Name","description":"User's full name"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email","description":"User's email address"},"phone":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Phone","description":"User's phone number"},"city":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"City","description":"User's city location"},"preferences":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Preferences","description":"User preferences"}},"type":"object","title":"UserProfileUpdate","description":"Request schema for updating user profile information.\n\nAll fields are optional, allowing users to update any subset of their profile.\nWhen a field is provided, it must pass validation rules.\n\nAttributes:\n    full_name: User's full name (must not be empty if provided)\n    email: User's email address (must be valid format if provided)\n    phone: User's phone number (must be valid format if provided)\n    city: User's city location (must not be empty if provided)\n    preferences: User preferences stored as JSON"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"},"input":{"title":"Input"},"ctx":{"type":"object","title":"Context"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}